<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>李二先生</title>
<meta name="description" content="李二先生的个博客，欢迎光临" />
<meta name="google-site-verification" content="FHNMdYV7a7Bw4HNt-vm0Cto8QvAW1Vx_rTrhMgxLg44" />
<link rel="shortcut icon" href="https://willisfusu.github.io/favicon.ico?v=1640282320249">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;700&family=Ubuntu:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
<script src='https://willisfusu.github.io/media/Valine.min.js'></script>
<link rel="stylesheet" href="https://willisfusu.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="李二先生 - Atom Feed" href="https://willisfusu.github.io/atom.xml">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>

    </head>
    <body>
    <div id="read-progress"></div>
<div class="fixed-top">
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
       <a class="navbar-brand" href="https://willisfusu.github.io">李二先生</a>
       <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
       </button>
       <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto"></ul>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="https://willisfusu.github.io/archives">「全部文章」</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://willisfusu.github.io/tag/will-tech">技术</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://willisfusu.github.io/tag/will-thinking">想法</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://willisfusu.github.io/tag/will-life">生活</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="">关于</a>
                </li>
            </ul>
       </div>
    </nav>
</div>

        <div class="container col-10" id="main" role="main">
            <div class="row">
                <div class="col-12 col-lg-8">
                    <article class="post">
                        <h1>
                            <a itemprop="url" class="post-title" href="https://willisfusu.github.io/post/jin-ri-tou-tiao-2/">今日头条新闻评论翻译</a>
                        </h1>
                        <p id="post-meta">
                            <i class="fa fa-clock-o"></i>2020-05-23 |
                            <i class="fa fa-tags"></i>
                                <a href="https://willisfusu.github.io/tag/will-tech/">技术</a>
                                
                                <a href="https://willisfusu.github.io/tag/jJ_HdEonj/">Python</a>
                                |
                            <i class="fa fa-book-reader"></i>5 min read
                        </p>
                        
                        
                            <blockquote class="fa fa-exclamation-triangle warning">
                                此文章发表于<strong><span style="color:#f75357">
                                        579</span></strong> 天前，请注意文章时效
                            </blockquote>
                            
                        <div class="post-content" itemprop="articleBody">
                            <p>上一篇文章我说到了由于老婆博士课题的原因，需要爬取今日头条的新闻评论，并且需要翻译成英文。我把评论的获取写成了文章，可以见<a href="https://willisfusu.github.io/post/jin-ri-tou-tiao-1/">此处</a>。今天我准备把如何使用 python 将中文翻译成英文总结一下，以备参考与之后复习之用。</p>
<!-- more -->
<h2 id="1-为什么会有这篇文章">🐶1 为什么会有这篇文章</h2>
<p>从老婆那边拿到的项目，她要求将今日头条的新闻评论翻译为英文，以为其博士课题服务。刚开始她是想着自己翻译，后来我我她大概需要多少评论翻译成英文，告诉我说大概800条…… 于是我就问她需不需要我先给她「机翻」一下，这样后期做较对要比自己翻译快很多。于是我就成功拿到了这个项目🤣🤣🤣🤣。</p>
<h2 id="️2-项目过程">🐼️2 项目过程</h2>
<h3 id="21-确定思路">2.1 确定思路</h3>
<p>因为我自己也没有「根红苗正」的 python 学习经历，学习 python 完全是为了老婆的博士课题服务。因此这里讲到的思路可能并不是正统的程序员思路，姑且看之。</p>
<ol>
<li>读取评论内容。从我们之前存入的数据库中读取评论内容。</li>
<li>找到谷歌翻译<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>的 API 接口，将评论传入。</li>
<li>处理返回的翻译结果。</li>
</ol>
<h3 id="22-谷歌翻译-api-的配置与使用-a-namegooglea">2.2 谷歌翻译 API 的配置与使用 <a name="google"></a></h3>
<p>这一部分内容建议阅读谷歌官方给出的指南，非常详细。分为了 Basic 与 Advanced 两个版本，选择任何一个指南进行都可以完成我们翻译文本的目标。</p>
<p>谷歌翻译 API 可以<a href="https://cloud.google.com/translate/docs/quickstarts">点击这里阅读</a>。简单说分为以下四步：</p>
<ol>
<li>创建 Cloud Console project，并获得 Private Key (一个 json 文件）</li>
<li>将第1步得到的 private key 添加到环境变量中</li>
<li>配置 Google Cloud SDK （此步骤又包含了许多小步骤）</li>
<li>安装 google-cloud-translate==2.0.1 python 库。</li>
</ol>
<pre><code>pip3 install google-cloud-translate==2.0.1
</code></pre>
<h3 id="23-代码实现">2.3 代码实现</h3>
<p>其实分析到这里，整个项目也差不多完成了。剩下的代码部分比较简单。可以分为两步：1.引入 google-cloud-translate 库。 2. 传入评论。</p>
<ol>
<li>引入 google-cloud-translate 库</li>
</ol>
<pre><code class="language-python">from google.cloud import translate_v2 as translate
# 引入 google.cloud 库，并重命名
translate_client=translate.Client()
# 创建translate对象
</code></pre>
<ol start="2">
<li>传入评论内容，并处理返回结果  <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></li>
</ol>
<pre><code class="language-python">def translate_comment(col):
    print('开始%s翻译'% col)
    collection = mydb[col]
    collection.update_many({}, {'$set': {'Comment_English': 'none'}})
    # 获取评论 collection, 并且增加'Comment_English' 字段。
    querry = {&quot;Comment_English&quot;: 'none'}
    comment_array = collection.find({}, {'comment_text': 1})
    print('已获取所有评论，准备开始翻译')
    for i in comment_array:
        ch_comment = emojis.decode(i['comment_text'])
        # 由于很多评论中使用了 emoji 谷歌翻译不能正确识别 emoji，所以需要使用 emoji 库将 emoji 转换为 unicode 编码。 emoji 就是 😂️😅️☺️ 这种。
        result=translate_client.translate(ch_comment,target_language='en')
        collection.update_one(querry, {'$set': {'Comment_English': result['translatedText']}})
        # 提交评论到谷歌翻译，并将返回的翻译结果更新 'Comment_English' 字段。
</code></pre>
<ol start="3">
<li>因为有多条新闻，所以有很多组评论，需要再写一个 for 循环。</li>
</ol>
<pre><code class="language-python">collectionarray = mydb.list_collection_names()
i = 1
for col in collectionarray:
    translate_comment(col)
    print('已经完成%d个库评论数据翻译' % i)
    i += 1
</code></pre>
<h3 id="24-说明">2.4 说明</h3>
<p>如果是在像 pycharm 这样的 IDE 中执行上面的程序，很大概率（之所以说很大概率是因为我只在 pycharm 中运行过）遇到报错，提示谷歌凭证配置错误。不要担心，只要你是<a href="#google">按照上面</a>指南配置，那应该不会有错。之所以出现这个报错是因为只能在 cmd 或者 terminal 中运行。到命令终端中运行刚刚写的 py 文件，看看是不是正常执行。如果还不正常，就按照上面的指南再配置一遍。</p>
<h2 id="️3-总结">🦁️3 总结</h2>
<h3 id="31-使用到库">3.1 使用到库</h3>
<ol>
<li>pymongo 数据库</li>
<li>emojis 处理评论中的 emoji，防止谷歌翻译报错</li>
<li>google.cloud 谷歌翻译库</li>
</ol>
<h3 id="32-pymongo-修改新增字段">3.2 pymongo 修改/新增字段</h3>
<p><a href="https://www.runoob.com/python3/python-mongodb-update-document.html">update/update_many/update_one</a></p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>这里选择谷歌翻译是因为人在英国，并且个人感觉谷歌翻译可能会比较准确一点？ <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p>再次说一下，这个项目中不一定非得使用数据库来存储，增加新字段，并更新字段浪费了我不少时间去学习🤪🤪🤪。 <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>

                        </div>
                         <blockquote>
                             <p>本文链接：<a style="text-decoration: underline" href="https://willisfusu.github.io/post/jin-ri-tou-tiao-2/">https://willisfusu.github.io/post/jin-ri-tou-tiao-2/</a></p>
                             <p>此文章由<a style="text-decoration: underline" href="https://willisfusu.github.io/">李二先生</a>采用<a style="text-decoration: underline" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a>进行许可,转载请注明出处。
                             </p>
                         </blockquote>
                    </article>
                    <ul class="post-near">
                        
                        <li>上一篇<a href="https://willisfusu.github.io/post/windows-software/">Windows软件推荐</a> </li>
                        
                        
                        <li>上一篇<a href="https://willisfusu.github.io/post/jin-ri-tou-tiao-1/">今日头条新闻评论获取</a> </li>
                        
                    </ul>
                    <div id="vcomment"></div>
                        <script>
                            new Valine({
                            el: '#vcomment',
                            appId: '62yofvjrBSK8xn2MoylBkRUJ-MdYXbMMI',
                            appKey: 'cfVwB8TO3A8o6l4Uo1h6OR9M',
                            avatar:"retro",
                            serverURLs:'https://62yofvjr.api.lncldglobal.com'
                        })
                        </script>
                </div>
                <div class="col-12 col-lg-4" id="secondary" role="complementary">
    <div class="card">
        <div class="card-header">
            <div class="widget-title">🚀关于李二先生</div>
        </div>
        <div class="card-body">
            <section class="tagline">
    Hey There, I'm <view class="under"><text class="textCon">WEI LI,</text><text class="borderText-lg"></text></view>
</section><br/>
<section class="desc">based in Manchester, UK.</section><br/>
<section class="tagline">A PhD Student in Materials</section>
<section class="desc">Focus on <view class="under"><text class="textCon">Graphene and Ceramic</text><text class="borderText-sm"></text> Composites.</view></section><br/>
<section class="tagline">And know a little about coding.</section>
<section class="desc">Maybe Just A Learner 🎉🤣</section>
        </div>
    </div>
    <div class="card" id="tag-card">
        <div class="card-header">
            <div class="widget-title">🏷️标签</div>
        </div>
        <div class="card-body">
            <div class="toc-container">
                <p style="margin-bottom: .5rem;">待施工……</p>
            </div>
        </div>
    </div>
    <div class="card" id="toc-card">
        <div class="card-header">
            <div class="widget-title">📒目录</div>
        </div>
        <div class="card-body">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E6%9C%89%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0">🐶1 为什么会有这篇文章</a></li>
<li><a href="#%EF%B8%8F2-%E9%A1%B9%E7%9B%AE%E8%BF%87%E7%A8%8B">🐼️2 项目过程</a>
<ul>
<li><a href="#21-%E7%A1%AE%E5%AE%9A%E6%80%9D%E8%B7%AF">2.1 确定思路</a></li>
<li><a href="#22-%E8%B0%B7%E6%AD%8C%E7%BF%BB%E8%AF%91-api-%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BD%BF%E7%94%A8-a-namegooglea">2.2 谷歌翻译 API 的配置与使用 <a name="google"></a></a></li>
<li><a href="#23-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0">2.3 代码实现</a></li>
<li><a href="#24-%E8%AF%B4%E6%98%8E">2.4 说明</a></li>
</ul>
</li>
<li><a href="#%EF%B8%8F3-%E6%80%BB%E7%BB%93">🦁️3 总结</a>
<ul>
<li><a href="#31-%E4%BD%BF%E7%94%A8%E5%88%B0%E5%BA%93">3.1 使用到库</a></li>
<li><a href="#32-pymongo-%E4%BF%AE%E6%94%B9%E6%96%B0%E5%A2%9E%E5%AD%97%E6%AE%B5">3.2 pymongo 修改/新增字段</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
    </div>
</div>

            </div>
        </div>
        <footer class="footer bottom" role="contentinfo">
    <a class="turn-up" href="#"><i class="fa fa-rocket"></i></a>
    <div id="dark-mode">
        <i class="fa fa-moon-o"></i>
    </div>
    Theme <a href="https://github.com/willisfusu/gridea-theme-SSRUI">SSRUI</a> made with <i class="fa fa-heart"></i> by <a href="https://willisfusu.github.io/">Wei LI</a>, modified from 🍀<a href="https://github.com/idealclover/Clover">Clover</a>🍀.<br/>
    Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>.<br />
    &copy; 2021 <a href="https://willisfusu.github.io">李二先生</a>.
    <div id="span_dt_dt"></div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"></script>
    <script src="https://willisfusu.github.io/media/mouse-click.js"></script>
    <script src="https://willisfusu.github.io/media/pace.min.js"></script>
    <script src="https://willisfusu.github.io/media/prism.js"></script>
    <script src="https://willisfusu.github.io/media/main_function.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
</footer>
    </body>
</html>
